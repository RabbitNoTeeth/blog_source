---
title: docker run 命令详解
description: docker run 参数详解，docker容器后台运行，docker容器磁盘挂载，docker容器端口映射，docker容器网络设置
lang: zh-CN
---

在通过 `docker run` 或者 `docker create` 命令创建容器时，通常并不仅是简单创建一个容器，还需要通过参数来满足我们更多的需求，比如需要容器后台运行、需要将容器端口映射到指定的宿主机端口、需要将宿主机的目录挂载到容器中等，下面将通过列举常用的场景，来理解各种参数的使用。

## 后台运行
容器后台运行，使用 `-d` 参数。

```
docker run -d IMAGE
```

## 端口映射
将容器端口映射到宿主机端口，使用 `-p` 参数。

```
docker run -p 8080:9090 IMAGE   # 将容器中的9090端口，映射到宿主机的8080端口
```


## 磁盘挂载
将宿主机目录挂载到容器中，使用 `-v` 参数。通常，我们需要将容器中应用生成的一些文件（如日志、上传的图片等）保存到宿主机中，因为容器的生命周期可能是比较短的，容器一旦删除，其内部的文件也会一并消失，那么这时我们就需要进行磁盘挂载，让容器产生的文件直接保存到宿主机中。

```
docker run -v /home/aaa:/home/bbb IMAGE   # 将宿主机的/home/aaa目录，挂载到容器的/home/bbb目录，容器中所有生成到/home/bbb目录下的文件，都会直接保存到宿主机的/home/aaa目录下
```

## 网络模式
docker容器的网络模式有以下几种：

| 模式 | 说明                                                                      |
|----|-------------------------------------------------------------------------|
|  bridge  | 这是docker默认使用的网络模式，创建了一个名为`docker0`的虚拟网桥，并为每个容器分配一个IP地址。容器间可以通过IP地址相互通信。 |
|  host  |  在这种模式下，容器直接使用宿主机的网络，并与宿主机共享网络接口。容器的网络配置与宿主机相同，可以通过宿主机的IP地址直接访问容器。 |
|  container  | 在这种模式下，容器与指定的另一个容器共享一个Network Namespace，而不是与宿主机共享。新创建的容器不会创建自己的网卡和IP，而是使用宿主机的网卡和IP。 |
|  none  |  在这种模式下，容器没有网络协议栈，也没有网卡、IP、路由等信息，只有lo网络接口。这意味着容器无法与其他容器或主机进行网络通信。                                                                       |
|  overlay  |  这是一种特殊的网络模式，用于实现容器间的网络透明性。Docker支持OverlayFS来实现这一功能，但它通常不被推荐用于生产环境，因为它可能涉及到一些复杂性和性能问题。                                                                       |

通常，我们直接使用默认的bridge模式，然后进行端口映射即可，但是在某些特殊场景下，我们可能需要更改网络模式，使应用的部署更加简单。

比如：数据库安装运行在宿主机上，应用通过容器进行部署，那么在应用连接数据库时，就需要从容器中访问宿主机端口，如果使用默认的网络模式，配置起来比较麻烦，这时，修改容器的网络模式为 host，那么容器便可以直接访问宿主机端口。

修改网络模式要使用 `--net` 参数。

```
docker run --net=host IMAGE   # 设置网络模式为host
```

## 自动删除
如果需要容器停止后自动删除，使用 `-rm` 参数。

```
docker run -rm IMAGE
```
